# æ‰¹é‡å›¾ç‰‡è¯†åˆ«

## éœ€æ±‚

> éœ€æ±‚ä¼ªä¸ä¼ªï¼Œæ²¡å…³ç³»ã€‚ä¸»è¦æ˜¯ç»ƒä¹ äº†Coding.

æ‰¹é‡è¯†åˆ«å›¾ç‰‡æ–‡å­—ï¼š

- æ‹ç…§çš„ä¿¡æ¯ï¼Œä»æ¥ä¸çœ‹çš„ã€‚ä½ é—®æˆ‘ï¼Œæˆ‘é—®è°å»ï¼Ÿ
- æ”¾æ‰‹æœºé‡Œé¢ç¡è§‰ä¹ŸæŒºå¥½çš„ã€‚è¯´ä¸å®šå•¥æ—¶å°±ç”¨ä¸Šäº†ï¼šï¼‰
- å†å‘Šè¯‰ä½ ä¸€ä¸ªç§˜å¯†ï¼Œå…¶å®ï¼Œæˆ‘å°±ç»ƒä¹ ä¸€ä¸‹Pythonã€‚è¿è¿™ä»½æ–‡ä»¶éƒ½åœ¨ç¡è§‰ o_o z Z



## ç›®å‰çš„è§£å†³æ–¹æ¡ˆ

- æˆç†Ÿçš„OCRè½¯ä»¶ï¼šå¤©è‹¥OCRï¼ŒPandaOCRï¼ŒOneNote
- ç›´æ¥çš„å›¾ç‰‡æœç´¢ï¼š å°è±¡ç¬”è®°
- å…¶ä»–ç±»æ‰‹æœºåº”ç”¨ï¼š ç™½æã€‚ã€‚ã€‚
- é—®é¢˜ï¼šè¦ä¹ˆä¸é€‚åˆæ‰¹é‡æ“ä½œï¼Œè¦ä¹ˆå¯¼è‡´å¤ªè¿‡æ··ä¹±ã€‚



## ç”¨é€”

1. æ’°å†™ç¬”è®°
2. æ•´ç†å›¾ç‰‡ä¿¡æ¯



## å®ç°

```python
#!usr/bin/python
# coding:utf-8

import sys
import json
import base64
import re
import os

# å¯¼å…¥Python3 æ¨¡å—
from urllib.request import urlopen
from urllib.request import Request
from urllib.error import URLError
from urllib.parse import urlencode
from urllib.parse import quote_plus


# é˜²æ­¢httpsè¯ä¹¦æ ¡éªŒä¸æ­£ç¡®
import ssl

ssl._create_default_https_context = ssl._create_unverified_context

# Python3 åº”ç”¨æ ‡è¯†
IS_PY3 = sys.version_info.major == 3

# Baidu AI 
API_KEY = 'fUr6iukVECdKe4llMB4KvTN1'

SECRET_KEY = 'TxtW3oNqG765lRGGtuoAcXZnVUWVrPCM'

OCR_URL = "https://aip.baidubce.com/rest/2.0/ocr/v1/accurate_basic"

"""  TOKEN start """
TOKEN_URL = 'https://aip.baidubce.com/oauth/2.0/token'


def fetch_token():
    """
    Function: è·å– Token
    return: None
    """
    params = {'grant_type': 'client_credentials',
              'client_id': API_KEY,
              'client_secret': SECRET_KEY}
    post_data = urlencode(params)
    if (IS_PY3):
        post_data = post_data.encode('utf-8')
    req = Request(TOKEN_URL, post_data)
    try:
        f = urlopen(req, timeout=5)
        result_str = f.read()
    except URLError as err:
        print(err)
    if (IS_PY3):
        result_str = result_str.decode()

    result = json.loads(result_str)

    if ('access_token' in result.keys() and 'scope' in result.keys()):
        if not 'brain_all_scope' in result['scope'].split(' '):
            print ('please ensure has check the  ability')
            exit()
        return result['access_token']
    else:
        print ('please overwrite the correct API_KEY and SECRET_KEY')
        exit()


def fetch_filelist():
    """
    Function: è·å–å½“å‰è·¯å¾„æ–‡ä»¶åˆ—è¡¨
    return: fileslist
    """


def read_file(image_path):
    """
    Function: è¯»å–æ–‡ä»¶
    return: æ–‡ä»¶æµ
    """
    # f = None
    # try:
    #     f = open(image_path, 'rb')
    #     return f.read()
    # except:
    #     print('read image file fail')
    #     return None
    # finally:
    #     if f:
    #         f.close()
    with open(image_path, "rb") as f:
        return f.read()


# è°ƒç”¨è¿œç¨‹æœåŠ¡
def request(url, data):
    """"
    Function: è°ƒç”¨è¿œç¨‹æœåŠ¡
    return: None
    """
    req = Request(url, data.encode('utf-8'))
    # has_error = False
    try:
        f = urlopen(req)
        result_str = f.read()
        if (IS_PY3):
            result_str = result_str.decode()
        return result_str
    except URLError as err:
        print(err)


def save_file(filename, text):
    """
    Function: ä¿å­˜æ–‡ä»¶è¯†åˆ«å†…å®¹åˆ°æ–‡æ¡£
    @Parm filename: è¯†åˆ«æ–‡ä»¶åç§° 
    @Parm text: è¯†åˆ«å†…å®¹
    return: None    
    """
    # è·å–ç¨‹åºæ–‡ä»¶ç›®å½•
    filepath = sys.path[0]

    # æ„å»ºæ–‡ä»¶
    file = "%s/file_content.txt" % filepath

    # å†™å…¥æ–‡ä»¶
    with open(file, "a") as f:
        f.write(filename)
        f.write("\n")
        f.write(text)
        f.write("\n" * 2)

    print("Well Done!")


def OCR(image_file):
    """
    Function: å›¾åƒè¯†åˆ«
    """
    # è·å–access token
    token = fetch_token()

    # æ‹¼æ¥é€šç”¨æ–‡å­—è¯†åˆ«é«˜ç²¾åº¦url
    image_url = OCR_URL + "?access_token=" + token
    # print("image_url: ", image_url)

    # è¯»å–å›¾ç‰‡
    file_content = read_file(image_file)
    # print("file_content: ", file_content)

    # è°ƒç”¨æ–‡å­—è¯†åˆ«æœåŠ¡
    result = request(image_url, urlencode({'image': base64.b64encode(file_content)}))

    # è§£æè¿”å›ç»“æœ
    text = ""
    result_json = json.loads(result)
    for words_result in result_json["words_result"]:
        text = text + words_result["words"]

    # æ‰“å°æ–‡å­—
    # print(text)

    # ä¿å­˜æ–‡æœ¬
    save_file(image_file, text)


def main():
    """
    Function: ä¸»å‡½æ•°
    Return: None
    """
    # è·å–å½“å‰æ–‡ä»¶è·¯å¾„
    filepath = sys.path[0]

    for filename in os.listdir(filepath):
        # print(filename)
        # åŒ¹é…å›¾ç‰‡æ–‡ä»¶
        if(re.match(r'.*.[png, jpg]$', filename)):
            print(filename)

            # æ„å»ºå®Œæ•´è·¯å¾„
            image_file = "%s/%s" % (filepath, filename)
            # print(image_file)

            # è¯†åˆ«å›¾ç‰‡æ–‡æœ¬
            OCR(image_file)
        else:
            print("æ–‡ä»¶ %s ä¸ç¬¦åˆè¯†åˆ«æ ¼å¼" % filename)


if __name__ == '__main__':
    main()
```



## ç”¨æ³•

1ï¼Œ å¤åˆ¶æ–‡ä»¶`AarOCR.py` åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ã€‚

2ï¼Œè¿è¡Œç¨‹åºï¼Œç»“æœè¾“å‡ºï¼šå½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨è¯†åˆ«çŠ¶æ€ï¼Œ å¹¶åœ¨æœ¬åœ°æ–‡ä»¶å¤¹ä¸­å¾—åˆ°æ–‡ä»¶`file_content.txt`

3ï¼Œå¤åˆ¶æ–‡ä»¶`file_content.txt`å†…å®¹å³å¯ã€‚



## å…¶ä»–

1. è¯¥æ–‡ä»¶é‡å¤æ‰§è¡Œå°†ä¼šåœ¨ä¸Šæ¬¡æ‰§è¡Œä¹‹åï¼Œè¿½åŠ å†…å®¹ã€‚
2. æœ¬æ–‡ä»¶é‡‡ç”¨ç™¾åº¦AI SDK æ¥å£å®ç°ã€‚å…³äºæ¥å£æ˜¯æˆ‘ä¸ªäººå…è´¹çš„ï¼Œç”¨å¾—ä¸å¤šï¼Œå°±ä¸å†åŠ èœœäº†ã€‚è‹¥æœ‰è¯»è€…å°è¯•ï¼Œå¯[è‡ªè¡Œç”³è¯·](http://ai.baidu.com/ai-doc/OCR/dk3iqnq51)æˆ–è€…æ¯æœˆç”¨å¤ªå¤šã€‚

3. ç›®å‰ï¼Œç¨‹åºæŠ“å–æ–‡æœ¬è¦ä¹ˆä¸æ¢è¡Œï¼Œè¦ä¹ˆæ¯è¯†åˆ«çš„æˆæ®µå†…å®¹ä¹‹é—´éƒ½è¦æ¢è¡Œï¼š`text = text + words_result["words"]`ã€‚ å› æ­¤æ— æ³•è¾¾åˆ°ç›®å‰æˆç†Ÿäº§å“å¦‚ï¼šå¤©è‹¥OCRï¼ŒPandaOCR é‚£èˆ¬ğŸ‚xã€‚å¯¼è‡´æ•´ç†çš„æ—¶å€™æ ¡å¯¹å·¥ä½œåšå¾—ç´¯äººï¼Œç‰¹åˆ«æ˜¯æ—¥ç‹—çš„å›¾è¡¨ã€‚